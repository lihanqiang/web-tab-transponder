!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Transponder=t():e.Transponder=t()}(self,(function(){return function(){"use strict";var __webpack_require__={d:function(e,t){for(var o in t)__webpack_require__.o(t,o)&&!__webpack_require__.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},__webpack_exports__={},thisId,storageKey,msgCallback;function addEvent(e,t){window.addEventListener?window.addEventListener(e,t):window.attachEvent("on"+e,t)}function removeEvent(e,t){window.removeEventListener?window.removeEventListener(e,t):window.detachEvent("on"+e,t)}function setLocal(e,t){window.localStorage.setItem(e,JSON.stringify(t))}function getpagetype(){var e="page";return window.frames&&window.parent&&window.frames.length!==window.parent.frames.length&&(e="iframe"),e}function getPageData(){return window.location?{href:window.location.href,pathname:window.location.pathname,hostname:window.location.hostname,port:window.location.port,protocol:window.location.protocol,hash:window.location.hash,search:window.location.search,pagetype:getpagetype()}:{}}function StorageTransponder(e){if("string"!=typeof e||!e)throw new Error('the param "id" is required, which is a string, but not ""!');if(thisId=e,this.destoryed=!1,storageKey="__&&transponderKeydoNotDelete&&__","object"!=typeof localStorage)throw new Error('"localStorage" is not supported in this environment!')}__webpack_require__.d(__webpack_exports__,{default:function(){return __WEBPACK_DEFAULT_EXPORT__}}),Function.prototype.apply||(Function.prototype.apply=function(obj,args){var i=0,ary=[],str;if(args)for(var len=args.length;i<len;i++)ary[i]="args["+i+"]";obj._apply=this,str="obj._apply("+ary.join(",")+")";try{return eval(str)}catch(e){}finally{delete obj._apply}}),Function.prototype.call||(Function.prototype.call=function(e){for(var t=1,o=[],r=arguments.length;t<r;t++)o[t-1]=arguments[t];return this.apply(e,o)}),StorageTransponder.prototype.send=function(e,t){if(this.destoryed)throw new Error("this instance has been destoryed!");var o=getPageData();if(void 0!==t)for(var r=t instanceof Array?t:[t],n=0;n<r.length;n++){var a=r[n];if("string"!=typeof a||!a)throw new Error('param "toId" is Array<string> or just a string, but not a ""!');o.id=thisId,setLocal(storageKey,{random:Math.random(),transferId:a,data:e,from:o})}else setLocal(storageKey,{random:Math.random(),transferId:void 0,data:e,from:o});return this},StorageTransponder.prototype.messageListener=function(e){var t=e.key,o=e.newValue,r=JSON.parse(o);if(t===storageKey&&r&&r.random){var n=r.transferId,a=r.data,i=r.from,s={data:a,from:i},d=i.id;n?d!==thisId&&n===thisId&&msgCallback.call(this,s):d!==thisId&&msgCallback.call(this,s)}},StorageTransponder.prototype.onMessage=function(e){return msgCallback=e||function(){},addEvent("storage",this.messageListener),this},StorageTransponder.prototype.destory=function(){removeEvent("storage",this.messageListener),this.destoryed=!0};const __WEBPACK_DEFAULT_EXPORT__=StorageTransponder;return __webpack_exports__=__webpack_exports__.default,__webpack_exports__}()}));